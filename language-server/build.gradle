/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java Library project to get you started.
 * For more details take a look at the Java Libraries chapter in the Gradle
 * user guide available at https://docs.gradle.org/4.10.2/userguide/java_library_plugin.html
 */

plugins {
    id 'java-library'
    id 'eclipse'
	id 'application'
}

application {
	mainClassName = 'de.systemticks.c4dsl.ls.C4LanguageServerLauncher'
	applicationName = 'c4-language-server'
}

startScripts {
	doLast {
		windowsScript.text = windowsScript.text.replaceAll('set CLASSPATH=.*', 'set CLASSPATH=.;%APP_HOME%/lib/*')
	}
}

sourceSets {
    main {
        java {
            srcDirs = ['src/main/java']
        }
        resources {
            srcDirs = ['src/main/resources']
        }
    }
    test {
        java {
            srcDirs = ['src/test/java']
        }
        resources {
            srcDirs = ['src/test/resources']
        }
    }
}

dependencies {

	implementation 'com.github.torsten-systemticks:dsl:parser_listener-SNAPSHOT'
	//implementation 'com.github.torsten-systemticks:dsl:master-1fe4b1f73a-1'

	//implementation 'com.structurizr:structurizr-dsl:1.13.1'
	implementation 'com.structurizr:structurizr-plantuml:1.6.3'
	implementation 'com.structurizr:structurizr-mermaid:1.4.1'
	implementation 'com.structurizr:structurizr-client:1.9.7'
	
	implementation group: 'org.eclipse.lsp4j', name: 'org.eclipse.lsp4j', version: '0.12.0'
	
	implementation 'ch.qos.logback:logback-classic:1.2.6'
	
    // Use JUnit test framework
    testImplementation 'junit:junit:4.12'
}

task deployToVSCode(type: Copy, dependsOn: distZip) {
	def zipFile = file("${buildDir}/distributions/c4-language-server.zip")
	def outputDir = file("${buildDir}/../../extension/server")

	fileMode = 0755

	from zipTree(zipFile)
	into outputDir
	
	exclude '**/kotlin*.jar'
	exclude '**/groovy*.jar'
	exclude '**/jruby*.jar'
	exclude '**/jnr*.jar'
	exclude '**/jcodings*.jar'
	exclude '**/jffi*.jar'
}

task cleanDeployedServer(type: Delete) {
	delete fileTree("${buildDir}/../../../extension/server")
}

build.dependsOn deployToVSCode

clean.dependsOn cleanDeployedServer

allprojects {
	// In this section you declare where to find the dependencies of your project
	repositories {
		// Use jcenter for resolving your dependencies.
		// You can declare any Maven/Ivy/file repository here.
		jcenter()
		maven { url 'https://jitpack.io' }
	}
}
